<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cash App Profile Viewer</title>

    <!-- Content Security Policy -->
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; img-src 'self' https://cash.app https://*.cash.app https://cloudfront.net https://*.cloudfront.net data:; style-src 'unsafe-inline'; script-src 'unsafe-inline';">

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .warning {
            background: #fff3cd;
            border: 2px solid #ffc107;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 20px;
            max-width: 800px;
            margin-left: auto;
            margin-right: auto;
        }

        .warning h3 {
            color: #856404;
            margin-bottom: 10px;
            font-size: 18px;
        }

        .warning p {
            color: #856404;
            font-size: 14px;
            line-height: 1.5;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: #fff;
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }

        h1 {
            color: #00d64f;
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5em;
        }

        .profile-image {
            text-align: center;
            margin: 30px 0;
        }

        .profile-image img {
            max-width: 300px;
            width: 100%;
            border-radius: 15px;
            border: 4px solid #00d64f;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }

        .no-image {
            background: #f5f5f5;
            padding: 40px;
            border-radius: 15px;
            color: #999;
            text-align: center;
            font-size: 18px;
        }

        .data-section {
            margin: 30px 0;
        }

        .data-row {
            display: flex;
            padding: 15px;
            border-bottom: 1px solid #eee;
            align-items: center;
        }

        .data-row:last-child {
            border-bottom: none;
        }

        .data-label {
            font-weight: bold;
            color: #333;
            min-width: 150px;
            font-size: 16px;
        }

        .data-value {
            color: #666;
            font-family: 'Courier New', monospace;
            font-size: 16px;
            word-break: break-word;
        }

        .verified {
            color: #00d64f;
            font-weight: bold;
        }

        .cashtag {
            color: #00d64f;
            font-size: 20px;
            font-weight: bold;
        }

        .error-message {
            background: #f8d7da;
            border: 2px solid #f5c6cb;
            color: #721c24;
            padding: 20px;
            border-radius: 10px;
            text-align: center;
            margin: 20px 0;
        }

        .btn-container {
            margin-top: 30px;
            text-align: center;
        }

        .btn {
            display: inline-block;
            padding: 12px 24px;
            margin: 5px;
            background: #00d64f;
            color: #000;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 14px;
            text-decoration: none;
            transition: all 0.3s;
        }

        .btn:hover {
            background: #00f55e;
            transform: translateY(-2px);
        }

        @media print {
            body {
                background: #fff;
                padding: 0;
            }
            .warning, .btn-container {
                display: none;
            }
        }

        @media (max-width: 600px) {
            .container {
                padding: 20px;
            }

            .data-row {
                flex-direction: column;
                align-items: flex-start;
            }

            .data-label {
                margin-bottom: 5px;
            }
        }
    </style>
</head>
<body>
    <!-- Security Warning -->
    <div class="warning">
        <h3>‚ö†Ô∏è Security Notice</h3>
        <p><strong>This page displays data from external sources.</strong> The information shown comes from URL parameters and has been sanitized for security. Always verify profile information directly on cash.app before taking any action. Do not share sensitive information based solely on this display.</p>
    </div>

    <div class="container" id="content">
        <!-- Content will be injected here by JavaScript -->
    </div>

    <script>
        // SECURITY: Sanitize function to prevent XSS
        function sanitize(str) {
            if (!str) return '';
            const div = document.createElement('div');
            div.textContent = str; // Uses textContent, not innerHTML
            return div.innerHTML;
        }

        // SECURITY: Validate image URL - only allow Cash App domains
        function isValidImageUrl(url) {
            if (!url) return false;
            try {
                const urlObj = new URL(url);
                const allowedDomains = [
                    'cash.app',
                    'cashapp.com',
                    'cloudfront.net'
                ];

                const hostname = urlObj.hostname.toLowerCase();

                // Check if hostname matches or is subdomain of allowed domains
                return allowedDomains.some(domain =>
                    hostname === domain || hostname.endsWith('.' + domain)
                );
            } catch (e) {
                console.error('Invalid URL:', e);
                return false;
            }
        }

        // Parse URL parameters
        function getParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                cashtag: params.get('cashtag') || '',
                name: params.get('name') || '',
                verified: params.get('verified') === '1',
                plan: params.get('plan') || '',
                country: params.get('country') || '',
                image: params.get('image') || ''
            };
        }

        // Render the profile
        function renderProfile() {
            const data = getParams();
            const container = document.getElementById('content');

            // Check if we have any data
            if (!data.cashtag && !data.name) {
                container.innerHTML = `
                    <div class="error-message">
                        <h2>‚ùå No Profile Data</h2>
                        <p>No profile information was provided in the URL.</p>
                        <p style="margin-top: 10px;">Use the Cash App bookmarklet to extract and view profile data.</p>
                    </div>
                `;
                return;
            }

            // Build HTML using sanitized data
            let html = '<h1>üí∞ ' + sanitize(data.name || 'Cash App Profile') + '</h1>';

            // Profile Image Section
            if (data.image && isValidImageUrl(data.image)) {
                html += '<div class="profile-image">';
                html += '<img src="' + sanitize(data.image) + '" alt="Profile Image" id="profileImg">';
                html += '</div>';
            } else if (data.image) {
                html += '<div class="profile-image">';
                html += '<div class="no-image">‚ö†Ô∏è Image URL blocked for security (invalid domain)</div>';
                html += '</div>';
            } else {
                html += '<div class="profile-image">';
                html += '<div class="no-image">üì∑ No profile image available</div>';
                html += '</div>';
            }

            // Profile Data Section
            html += '<div class="data-section">';

            if (data.cashtag) {
                html += '<div class="data-row">';
                html += '<div class="data-label">Cashtag:</div>';
                html += '<div class="data-value cashtag">' + sanitize(data.cashtag) + '</div>';
                html += '</div>';
            }

            if (data.name) {
                html += '<div class="data-row">';
                html += '<div class="data-label">Display Name:</div>';
                html += '<div class="data-value">' + sanitize(data.name) + '</div>';
                html += '</div>';
            }

            html += '<div class="data-row">';
            html += '<div class="data-label">Verified Account:</div>';
            html += '<div class="data-value ' + (data.verified ? 'verified' : '') + '">';
            html += data.verified ? '‚úì Yes' : '‚úó No';
            html += '</div>';
            html += '</div>';

            if (data.plan) {
                html += '<div class="data-row">';
                html += '<div class="data-label">Rate Plan:</div>';
                html += '<div class="data-value">' + sanitize(data.plan) + '</div>';
                html += '</div>';
            }

            if (data.country) {
                html += '<div class="data-row">';
                html += '<div class="data-label">Country Code:</div>';
                html += '<div class="data-value">' + sanitize(data.country) + '</div>';
                html += '</div>';
            }

            html += '</div>';

            // Buttons
            html += '<div class="btn-container">';
            html += '<button class="btn" onclick="window.print()">üñ®Ô∏è Print</button>';
            html += '<button class="btn" onclick="copyData()">üìã Copy Data</button>';
            html += '</div>';

            container.innerHTML = html;

            // Handle image load errors
            const img = document.getElementById('profileImg');
            if (img) {
                img.onerror = function() {
                    this.parentElement.innerHTML = '<div class="no-image">‚ùå Failed to load image</div>';
                };
            }
        }

        // Copy data to clipboard
        function copyData() {
            const data = getParams();
            let text = 'Cash App Profile\n\n';
            if (data.cashtag) text += 'Cashtag: ' + data.cashtag + '\n';
            if (data.name) text += 'Display Name: ' + data.name + '\n';
            text += 'Verified: ' + (data.verified ? 'Yes' : 'No') + '\n';
            if (data.plan) text += 'Rate Plan: ' + data.plan + '\n';
            if (data.country) text += 'Country: ' + data.country + '\n';
            if (data.image) text += 'Image URL: ' + data.image + '\n';

            navigator.clipboard.writeText(text).then(() => {
                alert('‚úì Profile data copied to clipboard!');
            }).catch(() => {
                // Fallback for older browsers
                const textarea = document.createElement('textarea');
                textarea.value = text;
                textarea.style.position = 'fixed';
                textarea.style.opacity = '0';
                document.body.appendChild(textarea);
                textarea.select();
                document.execCommand('copy');
                document.body.removeChild(textarea);
                alert('‚úì Profile data copied to clipboard!');
            });
        }

        // Initialize on page load
        renderProfile();
    </script>
</body>
</html>